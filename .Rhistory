s01_trials
glm_hmm2_s01 <- s01_trials %>%
glm_hmm_r(.num_states = 2)
glm_hmm2_s01
glm_hmm2_s01$recovered_weights
posterior_wins <- glm_hmm2_s01$posterior_probs %>%
group_by(trial) %>%
filter(p == max(p)) %>%
select(-p) %>%
mutate(state = str_remove(state,"V"))
averages_states <- glm_hmm2_s01$model_matrix_with_session %>%
mutate(trial = row_number()) %>%
left_join(posterior_wins, by = c("session", "trial")) %>%
group_by(duration, state) %>%
summarise(prob = mean(response), n = n(), .groups = "keep") %>%
left_join(glm_hmm2_s01$ordered_states, by = "state") %>%
mutate(prop = paste0(round(prop * 100), "%"),
state = paste(state, prop))
glm_hmm2_s01$model_matrix_with_session
glm_hmm2_s01$model_matrix_with_session %>%
mutate(trial = row_number()) %>%
left_join(posterior_wins, by = c("session", "trial")) %>%
group_by(duration, state)
averages_states <- glm_hmm2_s01$model_matrix_with_session %>%
mutate(trial = row_number()) %>%
left_join(posterior_wins, by = c("session", "trial")) %>%
group_by(dot_diff, state) %>%
summarise(prob = mean(response), n = n(), .groups = "keep") %>%
left_join(glm_hmm2_s01$ordered_states, by = "state") %>%
mutate(prop = paste0(round(prop * 100), "%"),
state = paste(state, prop))
averages_states
ggplot() +
geom_point(data = averages_states,
aes(x = dot_diff, y = prob, color = state, size = n)) +
geom_line(data = psycho_2_s01,
aes(x = dot_diff, y = prop, color = state)) +
ylim(0, 1)
ggplot() +
geom_point(data = averages_states,
aes(x = dot_diff, y = prob, color = state, size = n))+
# geom_line(data = psycho_2_s01,
#           aes(x = dot_diff, y = prop, color = state)) +
ylim(0, 1)
ggplot() +
geom_line(data = psycho_2_s01,
aes(x = dot_diff, y = prop, color = state)) +
ylim(0, 1)
source("~/.active-rstudio-document", echo=TRUE)
source("~/.active-rstudio-document", echo=TRUE)
dat <- mtcars |>
rowid_to_column()
dat
dat <- mtcars |>
rownames_to_column()
dat
source("~/.active-rstudio-document", echo=TRUE)
source("~/.active-rstudio-document", echo=TRUE)
source("~/.active-rstudio-document", echo=TRUE)
nrow(dat)
dat |> count(rowname)
dat |> ungroup() |> count(rowname)
n_rows(dat)
n_row(dat)
nrow(dat)
source("~/.active-rstudio-document", echo=TRUE)
library(reticulate)
use_condaenv("glmhmm")
source_python("python/glm_hmm.py")
reticulate::repl_python()
library(tidyverse)
library(broom)
library(dplyr)
library(R.matlab)
list.files("R", full.names = TRUE) |>
walk(source)
data_trials <- read_csv("data/data_Rouault_2018_Expt1.csv", show_col_types = FALSE)
data_trials <- rename(data_trials, subject = Subj_idx, stimulus = Stimulus, response = Response, confidence = Confidence, RT = RT_dec, dot_diff = DotDiff, correct = Accuracy)
data_trials <- data_trials |>
group_by(subject) |>
mutate(trial = row_number()) |>
ungroup() |>
mutate(stimulus = if_else(stimulus == 0, -1, 1),
dot_diff = stimulus * dot_diff,
prev_resp = lag(response),
fing_err = if_else(confidence == 1, 1, 0)) |>
drop_na()
data_trials
table(data_trials$subject, data_trials$stimulus) / rowSums(table(data_trials$subject, data_trials$stimulus))
data_trials
data_trials |>
group_by(subject) |>
count(stimulus)
?count
data_trials |>
group_by(subject)
data_trials |>
group_by(subject) |>
count(stimulus)
data_trials |>
group_by(subject) |>
count(stimulus) |>
mutate(prop = n / n())
115 / (115 + 94)
data_trials |>
group_by(subject) |>
count(stimulus) |>
group_by(subject) |>
mutate(prop = n / n())
?n
data_trials |>
group_by(subject) |>
count(stimulus) |>
group_by(subject) |>
mutate(prop = n / sum(n))
data_trials |>
group_by(subject) |>
count(stimulus) |>
group_by(subject) |>
mutate(prop = n / sum(n)) |>
pivot_wider(names_from = stimulus, values_from = prop)
data_trials |>
group_by(subject) |>
count(stimulus) |>
group_by(subject) |>
mutate(prop = n / sum(n))
data_trials |>
group_by(subject) |>
count(stimulus) |>
group_by(subject) |>
mutate(prop = n / sum(n))
data_trials |>
group_by(subject) |>
count(stimulus) |>
group_by(subject) |>
mutate(prop = n / sum(n)) |>
select(-n) |>
pivot_wider(names_from = stimulus, values_from = prop)
data_trials |>
group_by(subject) |>
count(stimulus) |>
group_by(subject) |>
mutate(prop = n / sum(n)) |>
select(-n) |>
pivot_wider(names_from = stimulus, values_from = prop)
table(data_trials$subject, data_trials$stimulus) / rowSums(table(data_trials$subject, data_trials$stimulus))
s01_trials <- data_trials %>%
filter(subject == 1) %>%
mutate(session = 1,
intercept = 1,
dot_diff = dot_diff) %>%
ungroup() %>%
select(session, response, intercept, dot_diff)
s01_trials
glm_hmm2_s01 <- s01_trials %>%
glm_hmm_r(.num_states = 2)
glm_hmm2_s01
glm_hmm2_s01$recovered_weights
psycho_2_s01 <- glm_hmm2_s01$recovered_weights |>
group_by(state) |>
reframe(create_psychometric(dot_diff, value))
ggplot() +
geom_line(data = psycho_2_s01,
aes(x = dot_diff, y = prop, color = state))
glm_hmm2_s01$posterior_probs
posterior_wins2_s01 <- glm_hmm2_s01$posterior_probs |>
group_by(trial) %>%
filter(p == max(p)) %>%
select(-p) %>%
mutate(state = str_remove(state,"V"))
posterior_wins2_s01
posterior_wins2_s01
posterior_wins2_s01 <- glm_hmm2_s01$posterior_probs |>
group_by(trial) %>%
filter(p == max(p)) %>%
select(-p) %>%
mutate(state = str_remove(state,"V"))
posterior_wins2_s01
glm_hmm2_s01$posterior_probs |>
group_by(trial) %>%
filter(p == max(p)) %>%
select(-p)
posterior_wins2_s01 <- glm_hmm2_s01$posterior_probs |>
group_by(trial) %>%
filter(p == max(p)) %>%
select(-p)
posterior_wins2_s01 <- glm_hmm2_s01$posterior_probs |>
group_by(trial) %>%
filter(p == max(p)) %>%
select(-p)
posterior_wins2_s01
posterior_wins2_s01 |> count(state)
posterior_wins2_s01 |>
ungroup() |>
count(state)
posterior_wins2_s01 <- glm_hmm2_s01$posterior_probs |>
group_by(trial) %>%
filter(p == max(p)) %>%
select(-p)
posterior_wins2_s01
trial_s01_plot <- ggplot() +
geom_line(data = glm_hmm2_s01$posterior_probs,
aes(x = trial, y = p, color = state)) +
geom_point(data = filter(data_trials, subject == 1), aes(x = trial, y = correct), shape = "|")
trial_s01_plot
trial2_s01_plot <- ggplot() +
geom_line(data = glm_hmm2_s01$posterior_probs,
aes(x = trial, y = p, color = state)) +
geom_point(data = filter(data_trials, subject == 1), aes(x = trial, y = correct), shape = "|")
trial2_s01_plot <- ggplot() +
geom_line(data = glm_hmm2_s01$posterior_probs,
aes(x = trial, y = p, color = state)) +
geom_point(data = filter(data_trials, subject == 1), aes(x = trial, y = correct), shape = "|")
trial2_s01_plot
data_trials
trial2_s01_plot <- ggplot() +
geom_line(data = glm_hmm2_s01$posterior_probs,
aes(x = trial, y = p, color = state)) +
geom_point(data = filter(data_trials, subject == 1), aes(x = trial, y = response), shape = "|")
trial2_s01_plot
glm_hmm2_s01 <- s01_trials %>%
glm_hmm_r(.num_states = 2, .seeds = 1:20, .all_seeds = TRUE)
glm_hmm2_s01
glm_hmm2_s01 %>%
arrange(log_lik) %>%
mutate(ordered_seed = row_number()) %>%
ggplot(aes(ordered_seed, log_lik)) +
geom_line() +
geom_point()
glm_hmm2_s01 <- s01_trials %>%
glm_hmm_r(.num_states = 2, .seeds = 1:40, .all_seeds = TRUE)
glm_hmm2_s01
glm_hmm2_s01 %>%
arrange(log_lik) %>%
mutate(ordered_seed = row_number()) %>%
ggplot(aes(ordered_seed, log_lik)) +
geom_line() +
geom_point()
glm_hmm2_s01_seeds <- s01_trials %>%
glm_hmm_r(.num_states = 2, .seeds = 1:40, .all_seeds = TRUE)
glm_hmm2_s01_seeds
glm_hmm2_s01_seeds %>%
arrange(log_lik) %>%
mutate(ordered_seed = row_number()) %>%
ggplot(aes(ordered_seed, log_lik)) +
geom_line() +
geom_point()
glm_hmm2_s01_seeds
glm_hmm2_s01_best <- glm_hmm2_s01_seeds |>
filter(log_lik == max(log_lik))
glm_hmm2_s01_best
glm_hmm2_s01_seeds |>
filter(log_lik == max(log_lik)) |>
pluck("fit")
glm_hmm2_s01_best <- glm_hmm2_s01_seeds |>
filter(log_lik == max(log_lik)) |>
pluck("fit") %>%
pluck(1)
glm_hmm2_s01_best
glm_hmm2_s01_best <- glm_hmm2_s01_seeds |>
filter(log_lik == max(log_lik)) |>
pluck("fit") %>%
pluck(1)
glm_hmm2_s01_best
psycho_2_s01_best <- glm_hmm2_s01_best$recovered_weights |>
group_by(state) |>
reframe(create_psychometric(dot_diff, value))
psycho_2_s01_best <- glm_hmm2_s01_best$recovered_weights |>
group_by(state) |>
reframe(create_psychometric(dot_diff, value))
ggplot() +
geom_line(data = psycho_2_s01_best,
aes(x = dot_diff, y = prop, color = state))
glm_hmm3_s01 <- s01_trials %>%
glm_hmm_r(.num_states = 3)
glm_hmm3_s01
psycho_3_s01 <- glm_hmm3_s01$recovered_weights |>
group_by(state) |>
reframe(create_psychometric(dot_diff, value))
psycho_3_s01 |> ggplot(aes(x = dot_diff, y = prop, color = state)) +
geom_line()
s01_trials <- data_trials %>%
filter(subject == 1) %>%
mutate(session = 1,
intercept = 1,
signed_contrast = dot_diff) %>%
ungroup() %>%
select(session, response, intercept, signed_contrast, trial)
ggplot() +
geom_line(data = glm_hmm3_s01$posterior_probs,
aes(x = trial, y = p, color = state)) +
geom_point(data = s01_trials, aes(x = trial, y = response), shape = "|")
s01_trials <- s01_trials %>%
select(session, response, intercept, signed_contrast)
glm_hmm3_s01 <- s01_trials %>%
glm_hmm_r(.num_states = 3, .seeds = 1:20, .all_seeds = TRUE)
glm_hmm3_s01
glm_hmm3_s01 %>%
arrange(log_lik) %>%
mutate(ordered_seed = row_number()) %>%
ggplot(aes(ordered_seed, log_lik)) +
geom_line() +
geom_point()
glm_hmm2_s01_AIC <- -2 * glm_hmm2_s01$log_lik + 2 * glm_hmm2_s01$n_par
glm_hmm3_s01_AIC <- -2 * glm_hmm3_s01$log_lik + 2 * glm_hmm3_s01$n_par
glm_hmm2_s01_AIC
glm_hmm3_s01_AIC
glm_hmm2_s01_AIC
glm_hmm3_s01_AIC
glm_hmm2_s01_AIC
glm_hmm3_s01_AIC
psycho_2_s01 |>
mutate(dot_diff_bin = cut_interval(dot_diff, 10)) |>
group_by(dot_diff_bin, state) |>
summarise(p = mean(prop), state = state) |>
ggplot(aes(dot_diff_bin, p, color = state)) +
geom_point() +
geom_line()
psycho_2_s01
psycho_2_s01 |>
mutate(dot_diff_bin = cut_interval(dot_diff, 10)) |>
group_by(dot_diff_bin, state) |>
summarise(p = mean(prop), state = state) |>
ggplot(aes(dot_diff_bin, p, color = state)) +
geom_point() +
geom_line()
data_trials
data_trials |>
filter(subject == 1) |>
mutate(dot_diff_bin = cut_interval(dot_diff, 10)) |>
group_by(dot_diff_bin, state) |>
summarise(p = mean(prop), state = state) |>
ggplot(aes(dot_diff_bin, p, color = state))
psycho_2_s01
glm_hmm2_s01$model_matrix_with_session
glm_hmm2_s01
glm_hmm2_s01_best$model_matrix_with_session
averages_states <- glm_hmm2_s01_best$model_matrix_with_session %>%
mutate(trial = row_number()) %>%
left_join(posterior_wins, by = c("session", "trial")) %>%
group_by(duration, state) %>%
summarise(prob = mean(response), n = n(), .groups = "keep")
glm_hmm2_s01_best$model_matrix_with_session %>%
mutate(trial = row_number()) %>%
left_join(posterior_wins, by = c("session", "trial"))
averages_states <- glm_hmm2_s01_best$model_matrix_with_session %>%
mutate(trial = row_number()) %>%
left_join(posterior_wins, by = c("session", "trial")) %>%
group_by(dot_diff, state) %>%
summarise(prob = mean(response), n = n(), .groups = "keep")
glm_hmm2_s01_best$model_matrix_with_session %>%
mutate(trial = row_number())
averages_states <- glm_hmm2_s01_best$model_matrix_with_session %>%
mutate(trial = row_number()) %>%
left_join(posterior_wins, by = c("session", "trial")) %>%
group_by(dot_diff, state) %>%
summarise(prob = mean(response), n = n(), .groups = "keep")
averages_states |>
mutate(dot_diff_bin = cut_interval(dot_diff, 10)) |>
group_by(dot_diff_bin, state) |>
summarise(p = mean(prop), state = state) |>
ggplot(aes(dot_diff_bin, p, color = state)) +
geom_point()
averages_states |>
mutate(dot_diff_bin = cut_interval(dot_diff, 10))
averages_states
averages_states |>
mutate(dot_diff_bin = cut_interval(dot_diff, 10))
averages_states
averages_states |>
ungroup() |>
mutate(dot_diff_bin = cut_interval(dot_diff, 10)) |
averages_states |>
ungroup() |>
mutate(dot_diff_bin = cut_interval(dot_diff, 10)) |>
group_by(dot_diff_bin, state) |>
summarise(p = mean(prop), state = state) |>
ggplot(aes(dot_diff_bin, p, color = state)) +
geom_point()
averages_states |>
ungroup() |>
mutate(dot_diff_bin = cut_interval(dot_diff, 10)) |>
group_by(dot_diff_bin, state)
averages_states |>
ungroup() |>
mutate(dot_diff_bin = cut_interval(dot_diff, 10)) |>
group_by(dot_diff_bin, state) |>
summarise(p = mean(prop), state = state)
averages_states |>
ungroup() |>
mutate(dot_diff_bin = cut_interval(dot_diff, 10)) |>
group_by(dot_diff_bin, state)
glm_hmm2_s01_best$model_matrix_with_session %>%
mutate(trial = row_number()) %>%
left_join(posterior_wins, by = c("session", "trial"))
averages_states <- glm_hmm2_s01_best$model_matrix_with_session %>%
mutate(trial = row_number()) %>%
left_join(posterior_wins, by = c("session", "trial")) %>%
mutate(dot_diff_bin = cut_interval(dot_diff, 10))
group_by(dot_diff_bin, state) %>%
summarise(prob = mean(response), n = n(), .groups = "keep")
averages_states <- glm_hmm2_s01_best$model_matrix_with_session %>%
mutate(trial = row_number()) %>%
left_join(posterior_wins, by = c("session", "trial")) %>%
mutate(dot_diff_bin = cut_interval(dot_diff, 10)) |>
group_by(dot_diff_bin, state) %>%
summarise(prob = mean(response), n = n(), .groups = "keep")
averages_states
averages_states |>
ggplot(aes(dot_diff_bin, p, color = state)) +
geom_point() +
geom_line()
averages_states |>
ggplot(aes(dot_diff_bin, p, color = state))
averages_states
averages_states |>
ggplot(aes(dot_diff_bin, p, color = state)) +
geom_point()
averages_states |>
ggplot(aes(dot_diff_bin, prob, color = state)) +
geom_point()
averages_states |>
ggplot(aes(dot_diff_bin, prob, color = state)) +
geom_point() +
geom_line(data = psycho_2_s01_best,
aes(x = dot_diff, y = prop, color = state))
psycho_2_s01_best_bin <- psycho_2_s01_best |>
mutate(dot_diff_bin = cut_interval(dot_diff, 10))
averages_states |>
ggplot(aes(dot_diff_bin, prob, color = state)) +
geom_point() +
geom_line(data = psycho_2_s01_best_bin |>
,
averages_states |>
ggplot(aes(dot_diff_bin, prob, color = state)) +
geom_point() +
geom_line(data = psycho_2_s01_best_bin,
aes(x = dot_diff, y = prop, color = state))
averages_states |>
ggplot(aes(dot_diff_bin, prob, color = state)) +
geom_point()
psycho_2_s01_best_bin <- psycho_2_s01_best |>
mutate(dot_diff_bin = cut_interval(dot_diff, 10))
averages_states |>
ggplot(aes(dot_diff_bin, prob, color = state)) +
geom_point() +
geom_line(data = psycho_2_s01_best_bin,
aes(x = dot_diff, y = prop, color = state))
psycho_2_s01_best_bin
averages_states |>
ggplot(aes(dot_diff_bin, prob, color = state)) +
geom_point() +
geom_line(data = psycho_2_s01_best_bin,
aes(x = dot_diff_bin, y = prop, color = state))
averages_states |>
ggplot(aes(dot_diff_bin, prob, color = state)) +
geom_point() +
geom_line(data = psycho_2_s01_best_bin,
aes(x = dot_diff_bin, y = prop, color = state, groups = state))
averages_states |>
ggplot(aes(dot_diff_bin, prob, color = state)) +
# geom_point() +
geom_line(data = psycho_2_s01_best,
aes(x = dot_diff, y = prop, color = state, groups = state))
averages_states <- glm_hmm2_s01_best$model_matrix_with_session %>%
mutate(trial = row_number()) %>%
left_join(posterior_wins, by = c("session", "trial")) %>%
mutate(dot_diff_bin = cut_interval(dot_diff, 10)) |>
group_by(dot_diff_bin, state) %>%
summarise(prob = mean(response), n = n(), .groups = "keep") |>
mutate(x = as.numeric(dot_diff_bin))
averages_states
glm_hmm2_s01_best$model_matrix_with_session %>%
mutate(trial = row_number()) %>%
left_join(posterior_wins, by = c("session", "trial")) %>%
mutate(dot_diff_bin = cut_interval(dot_diff, 10))
averages_states <- glm_hmm2_s01_best$model_matrix_with_session %>%
mutate(trial = row_number()) %>%
left_join(posterior_wins, by = c("session", "trial")) %>%
mutate(dot_diff_bin = cut_interval(dot_diff, 10)) |>
group_by(dot_diff_bin, state) %>%
summarise(dot_diff = mean(dot_diff), prob = mean(response), n = n(), .groups = "keep") |>
mutate(x = as.numeric(dot_diff_bin))
averages_states <- glm_hmm2_s01_best$model_matrix_with_session %>%
mutate(trial = row_number()) %>%
left_join(posterior_wins, by = c("session", "trial")) %>%
mutate(dot_diff_bin = cut_interval(dot_diff, 10)) |>
group_by(dot_diff_bin, state) %>%
summarise(dot_diff = mean(dot_diff), prob = mean(response), n = n(), .groups = "keep")
averages_states |>
ggplot(aes(dot_diff_bin, prob, color = state)) +
geom_point() +
geom_line(data = psycho_2_s01_best,
aes(x = dot_diff, y = prop, color = state, groups = state))
averages_states |>
ggplot(aes(dot_diff, prob, color = state)) +
geom_point() +
geom_line(data = psycho_2_s01_best,
aes(x = dot_diff, y = prop, color = state, groups = state))
psycho_2_s01 |>
mutate(dot_diff_bin = cut_interval(dot_diff, 10)) |>
group_by(dot_diff_bin, state) |>
summarise(p = mean(prop), state = state) |>
ggplot(aes(dot_diff_bin, p, color = state)) +
geom_point() +
geom_line()
library(reticulate)
use_condaenv("glmhmm")
library(reticulate)
use_condaenv("glmhmm")
source_python("python/glm_hmm.py")
reticulate::repl_python()
