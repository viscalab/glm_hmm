walk(source)
load("RData/glm_hmm1_seeds.RData")
load("RData/glm_hmm1_seeds.RData")
getwd()
load("RData/glm_hmm1_seeds.RData")
load("RData/glm_hmm2_seeds.RData")
load("RData/glm_hmm2_seeds.RData")
load("RData/glm_hmm3_seeds.RData")
liks_glm_hmm1 <- glm_hmm1_seeds %>%
mutate(fit = list(glm_hmm_extract_best(fit))) %>%
unnest_wider(fit) %>%
mutate(n = map(data, count)) %>%
unnest(n) %>%
select(subject, log_lik, n_par, n) %>%
mutate(model = "int-slo 1")
liks_glm_hmm2 <- glm_hmm2_seeds %>%
mutate(fit = list(glm_hmm_extract_best(fit))) %>%
unnest_wider(fit) %>%
mutate(n = map(data, count)) %>%
unnest(n) %>%
select(subject, log_lik, n_par, n) %>%
mutate(model = "int-slo 2")
liks_glm_hmm3 <- glm_hmm3_seeds %>%
mutate(fit = list(glm_hmm_extract_best(fit))) %>%
unnest_wider(fit) %>%
mutate(n = map(data, count)) %>%
unnest(n) %>%
select(subject, log_lik, n_par, n) %>%
mutate(model = "int-slo 3")
liks_glm_hmm <- liks_glm_hmm1 |>
bind_rows(liks_glm_hmm2) |>
bind_rows(liks_glm_hmm3) |>
mutate(aic = -2 * log_lik + 2 *n_par)
library(reticulate)
use_condaenv("glmhmm")
source_python("python/glm_hmm.py")
reticulate::repl_python()
library(tidyverse)
library(broom)
library(dplyr)
library(R.matlab)
library(cowplot)
list.files("R", full.names = TRUE) |>
walk(source)
load("RData/glm_hmm1_seeds.RData")
load("RData/glm_hmm2_seeds.RData")
load("RData/glm_hmm3_seeds.RData")
load("RData/glm_hmm1.RData")
load("RData/glm_hmm2.RData")
load("RData/glm_hmm3.RData")
glm_hmm1_seeds
liks_glm_hmm1 <- glm_hmm1_seeds %>%
mutate(fit = list(glm_hmm_extract_best(fit))) %>%
unnest_wider(fit) %>%
mutate(n = map(data, count)) %>%
unnest(n) %>%
select(subject, log_lik, n_par, n) %>%
mutate(model = "int-slo 1")
liks_glm_hmm2 <- glm_hmm2_seeds %>%
mutate(fit = list(glm_hmm_extract_best(fit))) %>%
unnest_wider(fit) %>%
mutate(n = map(data, count)) %>%
unnest(n) %>%
select(subject, log_lik, n_par, n) %>%
mutate(model = "int-slo 2")
liks_glm_hmm2 <- glm_hmm2_seeds %>%
mutate(fit = list(glm_hmm_extract_best(fit))) %>%
unnest_wider(fit) %>%
mutate(n = map(data, count)) %>%
unnest(n) %>%
select(subject, log_lik, n_par, n) %>%
mutate(model = "int-slo 2")
liks_glm_hmm3 <- glm_hmm3_seeds %>%
mutate(fit = list(glm_hmm_extract_best(fit))) %>%
unnest_wider(fit) %>%
mutate(n = map(data, count)) %>%
unnest(n) %>%
select(subject, log_lik, n_par, n) %>%
mutate(model = "int-slo 3")
liks_glm_hmm <- liks_glm_hmm1 |>
bind_rows(liks_glm_hmm2) |>
bind_rows(liks_glm_hmm3) |>
mutate(aic = -2 * log_lik + 2 *n_par)
liks_glm_hmm_best <- liks_glm_hmm |>
group_by(subject) |>
filter(aic == min(aic))
liks_glm_hmm_best |>
ungroup() |>
count(model)
glm_hmm4_seeds <- design_matrix |>
group_by(subject) |>
nest() %>%
rowwise() %>%
mutate(fit = list(glm_hmm_r(data,
.num_states = 4, .seeds = 1:n_seeds,
.all_seeds = TRUE)))
data_trials <- read_csv("data/data_Rouault_2018_Expt1.csv", show_col_types = FALSE)
data_trials <- rename(data_trials, subject = Subj_idx, stimulus = Stimulus, response = Response, confidence = Confidence, RT = RT_dec, dot_diff = DotDiff, correct = Accuracy)
data_trials <- data_trials |>
group_by(subject) |>
mutate(trial = row_number()) |>
mutate(stimulus = if_else(stimulus == 0, -1, 1),
dot_diff = stimulus * dot_diff)
design_matrix <- data_trials %>%
mutate(session = 1,
intercept = 1,
dot_diff = dot_diff) %>%
ungroup() %>%
select(subject, session, response, intercept, dot_diff)
design_matrix
glm_hmm4_seeds <- design_matrix |>
group_by(subject) |>
nest() %>%
rowwise() %>%
mutate(fit = list(glm_hmm_r(data,
.num_states = 4, .seeds = 1:n_seeds,
.all_seeds = TRUE)))
library(tidyverse)
library(broom)
library(dplyr)
library(R.matlab)
library(cowplot)
list.files("R", full.names = TRUE) |>
walk(source)
n_seeds <- 20
glm_hmm4_seeds <- design_matrix |>
group_by(subject) |>
nest() %>%
rowwise() %>%
mutate(fit = list(glm_hmm_r(data,
.num_states = 4, .seeds = 1:n_seeds,
.all_seeds = TRUE)))
save(glm_hmm4_seeds, file = "RData/glm_hmm4_seeds.RData")
glm_hmm4 <- glm_hmm4_seeds %>%
mutate(fit = list(glm_hmm_extract_best(fit))) %>%
order_states_glm_hmm()
save(glm_hmm4, file = "RData/glm_hmm4.RData")
data_trials
data_trials_52 <- data_trials |>
group_by(subject) |>
mutate(trial = row_number()) |>
filter(trial <= 52) |>
mutate(stimulus = if_else(stimulus == 0, -1, 1),
dot_diff = stimulus * dot_diff)
data_trials_52 |> filter(subject == 1) |> view()
52*3
glm_hmm1_seeds_156 <- design_matrix_156 |>
group_by(subject) |>
nest() %>%
rowwise() %>%
mutate(fit = list(glm_hmm_r(data,
.num_states = 1, .seeds = 1:n_seeds,
.all_seeds = TRUE)))
library(reticulate)
use_condaenv("glmhmm")
source_python("python/glm_hmm.py")
reticulate::repl_python()
library(tidyverse)
library(broom)
library(dplyr)
library(R.matlab)
library(cowplot)
list.files("R", full.names = TRUE) |>
walk(source)
data_trials <- read_csv("data/data_Rouault_2018_Expt1.csv", show_col_types = FALSE)
data_trials <- rename(data_trials, subject = Subj_idx, stimulus = Stimulus, response = Response, confidence = Confidence, RT = RT_dec, dot_diff = DotDiff, correct = Accuracy)
data_trials_156 <- data_trials |>
group_by(subject) |>
mutate(trial = row_number()) |>
filter(trial <= 156) |>
mutate(stimulus = if_else(stimulus == 0, -1, 1),
dot_diff = stimulus * dot_diff)
design_matrix_156 <- data_trials_156 %>%
mutate(session = 1,
intercept = 1,
dot_diff = dot_diff) %>%
ungroup() %>%
select(subject, session, response, intercept, dot_diff)
design_matrix_156
n_seeds <- 20
glm_hmm1_seeds_156 <- design_matrix_156 |>
group_by(subject) |>
nest() %>%
rowwise() %>%
mutate(fit = list(glm_hmm_r(data,
.num_states = 1, .seeds = 1:n_seeds,
.all_seeds = TRUE)))
save(glm_hmm1_seeds_156, file = "RData/glm_hmm1_seeds_156.RData")
glm_hmm2_seeds_156 <- design_matrix_156 |>
group_by(subject) |>
nest() %>%
rowwise() %>%
mutate(fit = list(glm_hmm_r(data,
.num_states = 2, .seeds = 1:n_seeds,
.all_seeds = TRUE)))
#save(glm_hmm2_seeds_156, file = "RData/glm_hmm2_seeds_156.RData")
glm_hmm3_seeds_156 <- design_matrix_156 |>
group_by(subject) |>
nest() %>%
rowwise() %>%
mutate(fit = list(glm_hmm_r(data,
.num_states = 3, .seeds = 1:n_seeds,
.all_seeds = TRUE)))
#save(glm_hmm3_seeds_156, file = "RData/glm_hmm3_seeds_156.RData")
glm_hmm4_seeds_156 <- design_matrix_156 |>
group_by(subject) |>
nest() %>%
rowwise() %>%
mutate(fit = list(glm_hmm_r(data,
.num_states = 4, .seeds = 1:n_seeds,
.all_seeds = TRUE)))
save(glm_hmm4_seeds_156, file = "RData/glm_hmm4_seeds_156.RData")
save(glm_hmm3_seeds_156, file = "RData/glm_hmm3_seeds_156.RData")
save(glm_hmm2_seeds_156, file = "RData/glm_hmm2_seeds_156.RData")
52*3
52*2
glm_hmm1_seeds_104 <- design_matrix_104 |>
group_by(subject) |>
nest() %>%
rowwise() %>%
mutate(fit = list(glm_hmm_r(data,
.num_states = 1, .seeds = 1:n_seeds,
.all_seeds = TRUE)))
library(reticulate)
use_condaenv("glmhmm")
source_python("python/glm_hmm.py")
reticulate::repl_python()
library(tidyverse)
library(broom)
library(dplyr)
library(R.matlab)
library(cowplot)
list.files("R", full.names = TRUE) |>
walk(source)
data_trials <- read_csv("data/data_Rouault_2018_Expt1.csv", show_col_types = FALSE)
data_trials <- rename(data_trials, subject = Subj_idx, stimulus = Stimulus, response = Response, confidence = Confidence, RT = RT_dec, dot_diff = DotDiff, correct = Accuracy)
data_trials_156 <- data_trials |>
group_by(subject) |>
mutate(trial = row_number()) |>
filter(trial <= 104) |>
mutate(stimulus = if_else(stimulus == 0, -1, 1),
dot_diff = stimulus * dot_diff)
design_matrix_156 <- data_trials_156 %>%
mutate(session = 1,
intercept = 1,
dot_diff = dot_diff) %>%
ungroup() %>%
select(subject, session, response, intercept, dot_diff)
design_matrix_104
data_trials <- read_csv("data/data_Rouault_2018_Expt1.csv", show_col_types = FALSE)
data_trials <- rename(data_trials, subject = Subj_idx, stimulus = Stimulus, response = Response, confidence = Confidence, RT = RT_dec, dot_diff = DotDiff, correct = Accuracy)
data_trials_104 <- data_trials |>
group_by(subject) |>
mutate(trial = row_number()) |>
filter(trial <= 104) |>
mutate(stimulus = if_else(stimulus == 0, -1, 1),
dot_diff = stimulus * dot_diff)
design_matrix_104 <- data_trials_104 %>%
mutate(session = 1,
intercept = 1,
dot_diff = dot_diff) %>%
ungroup() %>%
select(subject, session, response, intercept, dot_diff)
design_matrix_104
n_seeds <- 20
glm_hmm1_seeds_104 <- design_matrix_104 |>
group_by(subject) |>
nest() %>%
rowwise() %>%
mutate(fit = list(glm_hmm_r(data,
.num_states = 1, .seeds = 1:n_seeds,
.all_seeds = TRUE)))
save(glm_hmm1_seeds_104, file = "RData/glm_hmm1_seeds_104.RData")
glm_hmm2_seeds_104 <- design_matrix_104 |>
group_by(subject) |>
nest() %>%
rowwise() %>%
mutate(fit = list(glm_hmm_r(data,
.num_states = 2, .seeds = 1:n_seeds,
.all_seeds = TRUE)))
save(glm_hmm2_seeds_104, file = "RData/glm_hmm2_seeds_104.RData")
glm_hmm3_seeds_104 <- design_matrix_104 |>
group_by(subject) |>
nest() %>%
rowwise() %>%
mutate(fit = list(glm_hmm_r(data,
.num_states = 3, .seeds = 1:n_seeds,
.all_seeds = TRUE)))
save(glm_hmm3_seeds_104, file = "RData/glm_hmm3_seeds_104.RData")
glm_hmm4_seeds_104 <- design_matrix_104 |>
group_by(subject) |>
nest() %>%
rowwise() %>%
mutate(fit = list(glm_hmm_r(data,
.num_states = 4, .seeds = 1:n_seeds,
.all_seeds = TRUE)))
save(glm_hmm4_seeds_104, file = "RData/glm_hmm4_seeds_104.RData")
library(reticulate)
use_condaenv("glmhmm")
source_python("python/glm_hmm.py")
reticulate::repl_python()
library(tidyverse)
library(broom)
library(dplyr)
library(R.matlab)
library(cowplot)
list.files("R", full.names = TRUE) |>
walk(source)
data_trials <- read_csv("data/data_Rouault_2018_Expt1.csv", show_col_types = FALSE)
data_trials <- rename(data_trials, subject = Subj_idx, stimulus = Stimulus, response = Response, confidence = Confidence, RT = RT_dec, dot_diff = DotDiff, correct = Accuracy)
data_trials_52 <- data_trials |>
group_by(subject) |>
mutate(trial = row_number()) |>
filter(trial <= 52) |>
mutate(stimulus = if_else(stimulus == 0, -1, 1),
dot_diff = stimulus * dot_diff)
design_matrix_52 <- data_trials_52 %>%
mutate(session = 1,
intercept = 1,
dot_diff = dot_diff) %>%
ungroup() %>%
select(subject, session, response, intercept, dot_diff)
design_matrix_52
n_seeds <- 20
glm_hmm1_seeds_52 <- design_matrix_52 |>
group_by(subject) |>
nest() %>%
rowwise() %>%
mutate(fit = list(glm_hmm_r(data,
.num_states = 1, .seeds = 1:n_seeds,
.all_seeds = TRUE)))
save(glm_hmm1_seeds_52, file = "RData/glm_hmm1_seeds_52.RData")
glm_hmm2_seeds_52 <- design_matrix_52 |>
group_by(subject) |>
nest() %>%
rowwise() %>%
mutate(fit = list(glm_hmm_r(data,
.num_states = 2, .seeds = 1:n_seeds,
.all_seeds = TRUE)))
save(glm_hmm2_seeds_52, file = "RData/glm_hmm2_seeds_52.RData")
glm_hmm3_seeds_52 <- design_matrix_52 |>
group_by(subject) |>
nest() %>%
rowwise() %>%
mutate(fit = list(glm_hmm_r(data,
.num_states = 3, .seeds = 1:n_seeds,
.all_seeds = TRUE)))
save(glm_hmm3_seeds_52, file = "RData/glm_hmm3_seeds_52.RData")
glm_hmm4_seeds_52 <- design_matrix_52 |>
group_by(subject) |>
nest() %>%
rowwise() %>%
mutate(fit = list(glm_hmm_r(data,
.num_states = 4, .seeds = 1:n_seeds,
.all_seeds = TRUE)))
save(glm_hmm4_seeds_52, file = "RData/glm_hmm4_seeds_52.RData")
liks_glm_hmm1
liks_glm_hmm
data_trials
data_trials
data_trials
glm_hmm2
glm_hmm2_seeds
glm_hmm2_seeds %>%
mutate(fit = list(glm_hmm_extract_best(fit)))
xx2 <- glm_hmm2_seeds %>%
mutate(fit = list(glm_hmm_extract_best(fit))) %>%
order_states_glm_hmm()
xx2
order_states_glm_hmm
xx2
yy <-  glm_hmm2_seeds %>%
mutate(fit = list(glm_hmm_extract_best(fit)))
yy
yy
yyy <- yy |>
select(-data) |>
unnest_wider(fit)
yyy
yyy <- yy |>
select(-data) |>
unnest_wider(fit) |>
select(subject, recovered_weights)
yyy
yyy <- yy |>
select(-data) |>
unnest_wider(fit) |>
select(subject, recovered_weights) |>
unnest(recovered_weights)
yyy
xx2
yyy |> view()
xx2 |> view()
order_states_glm_hmm
xx2 <- glm_hmm2_seeds %>%
mutate(fit = list(glm_hmm_extract_best(fit))) %>%
order_states_glm_hmm() |>
filter(coef == "V2")
xx2
yyy <- yy |>
select(-data) |>
unnest_wider(fit) |>
select(subject, recovered_weights) |>
unnest(recovered_weights) |>
filter(coef == "V2")
xx2
yyy
order_states_glm_hmm
glm2 <- glm_hmm2_seeds %>%
mutate(fit = list(glm_hmm_extract_best(fit)))
glm_hmm2_weights <- glm_hmm2_seeds %>%
mutate(fit = list(glm_hmm_extract_best(fit))) |>
select(-data) |>
unnest_wider(fit) |>
select(subject, recovered_weights) |>
unnest(recovered_weights)
glm_hmm2_weights <- glm_hmm2_seeds %>%
mutate(fit = list(glm_hmm_extract_best(fit))) |>
select(-data) |>
unnest_wider(fit) |>
select(subject, recovered_weights) |>
unnest(recovered_weights)
glm_hmm2_weights
order <- glm_hmm2_weights |>
filter(coef == "V2") |>
group_by(subject) |>
arrange(desc(value), .by_group = TRUE) |>
mutate(ordered_state = paste0("S", row_number())) |>
select(subject, state, ordered_state)
order
order <- glm_hmm2_weights |>
filter(coef == "V2") |>
group_by(subject) |>
arrange(desc(value), .by_group = TRUE) |>
mutate(ordered_state = paste0("S", row_number()))
order
glm_hmm2_weights
glm_hmm2_weights |> as.data.frame() |> head(50)
order <- glm_hmm2_weights |>
filter(coef == "V2") |>
group_by(subject) |>
arrange(desc(value), .by_group = TRUE) |>
mutate(ordered_state = paste0("S", row_number())) |>
select(subject, state, ordered_state)
order
glm_hmm2_weights |>
left_join(order)
glm_hmm2_weights |>
left_join(order) |>
select(-state) |>
rename(state = ordered_state)
source("~/Dropbox/viscalab/glm_hmm/R/order_states_glm_hmm.R", echo=TRUE)
source("~/Dropbox/viscalab/glm_hmm/R/order_states_glm_hmm.R", echo=TRUE)
glm_hmm2 <- glm_hmm2_seeds %>%
mutate(fit = list(glm_hmm_extract_best(fit))) %>%
order_states_glm_hmm()
glm_hmm2
glm_hmm2 |> filter(coef == "V2")
source("~/Dropbox/viscalab/glm_hmm/R/order_states_glm_hmm.R", echo=TRUE)
order_states_glm_hmm
glm_hmm2_seeds %>%
mutate(fit = list(glm_hmm_extract_best(fit))) |>
select(-data) |>
unnest_wider(fit)
glm_hmm2
glm_hmm2 <- glm_hmm2_seeds %>%
mutate(fit = list(glm_hmm_extract_best(fit))) |>
select(-data) |>
unnest_wider(fit)
glm_hmm2
glm_hmm2_weights <- glm_hmm2 |>
select(subject, recovered_weights) |>
unnest(recovered_weights)
glm_hmm2
glm_hmm2_weights <- glm_hmm2 |>
select(subject, recovered_weights) |>
unnest(recovered_weights)
glm_hmm2
glm_hmm2_weights <- glm_hmm2 |>
select(subject, recovered_weights) |>
unnest(recovered_weights)
glm_hmm2
glm_hmm2 |>
select(subject, recovered_weights)
glm_hmm2_weights <- glm_hmm2 |>
select(subject, recovered_weights) |>
unnest(recovered_weights)
glm_hmm2_weights  <- glm_hmm2_seeds %>%
mutate(fit = list(glm_hmm_extract_best(fit))) |>
select(-data) |>
unnest_wider(fit) |>
select(subject, recovered_weights) |>
unnest(recovered_weights)
glm_hmm2 <- glm_hmm2_seeds %>%
mutate(fit = list(glm_hmm_extract_best(fit))) |>
select(-data) |>
unnest_wider(fit)
library(tidyverse)
library(broom)
library(dplyr)
library(R.matlab)
library(cowplot)
list.files("R", full.names = TRUE) |>
walk(source)
reticulate::repl_python()
library(reticulate)
use_condaenv("glmhmm")
library(reticulate)
library(reticulate)
use_condaenv("glmhmm")
source_python("python/glm_hmm.py")
reticulate::repl_python()
